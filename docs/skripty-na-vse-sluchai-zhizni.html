<!DOCTYPE html>
<html lang="en">
<head>
        <title>YODA : "Скрипты на все случаи жизни"</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="https://srv-nix.com/theme/css/main.css" type="text/css" />
        <link href="https://srv-nix.com/" type="application/atom+xml" rel="alternate" title="YODA ATOM Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="https://srv-nix.com/css/ie.css"/>
                <script src="https://srv-nix.com/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="https://srv-nix.com/css/ie6.css"/><![endif]-->

</head>

<body>
	<div id="wrap" style="width:850px">
	    <div id="container" style="width:560px">


            <div class="entry">
        
<header>
<h1><a href="https://srv-nix.com" id="site-title">  </a>         <a href="https://srv-nix.com/skripty-na-vse-sluchai-zhizni.html" id="page-title">"Скрипты на все случаи жизни"</a></h1>
<time datetime="2014-02-25T11:52:31+06:00">Tue 25 February 2014</time></header>
<article>
    <p>Хотел просто сделать коллекцию скриптов, которые приходится писать довольно часто, а получился модульный фреймворк для работы с любыми скриптами. В базовый функционал вынесены только функции для работы с логированием, навешиванием lock-файла при необходимости, почтовые рассылки, функции для работы с выводом и прочее.</p>
<p>Сам фреймворк можно найти <a href="https://github.com/wilful/root-shell">тут</a>.</p>
<p>Как это работает</p>
<p>Для работы скрипта необходимо скопировать (или слинковать) файл конфигурации:</p>
<div class="highlight"><pre><span></span><code>ln -s <span class="cp">${</span><span class="n">script_root</span><span class="cp">}</span>/usr/share/rc.conf.example <span class="cp">${</span><span class="n">script_root</span><span class="cp">}</span>/etc/rc.conf
</code></pre></div>

<p>После чего можно запустить скрипт без параметров:</p>
<div class="highlight"><pre><span></span><code><span class="n">$</span> <span class="n">bash</span> <span class="n">$</span><span class="p">{</span><span class="n">script_root</span><span class="p">}</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">wilshell</span><span class="p">.</span><span class="n">sh</span> 
<span class="o">==</span><span class="p">[</span> <span class="n">Debug</span> <span class="n">inf</span><span class="p">.</span> <span class="p">]</span><span class="o">==</span>  
    <span class="mi">2012-11-28</span><span class="n">_02</span><span class="mi">-44</span> <span class="p">[</span><span class="n">LogLevel</span> <span class="n">set</span> <span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="n">Usage</span> <span class="n">simple</span><span class="p">]</span>
<span class="o">==</span><span class="p">[</span> <span class="n">Usage</span> <span class="p">]</span><span class="o">==</span>   
    <span class="n">lock</span>     <span class="o">==&gt;</span> <span class="n">Module</span> <span class="n">to</span> <span class="n">lock</span> <span class="n">the</span> <span class="n">script</span>
    <span class="n">cleaner</span>  <span class="o">==&gt;</span> <span class="n">The</span> <span class="n">module</span> <span class="k">for</span> <span class="n">cleaning</span> <span class="n">old</span> <span class="n">files</span>
    <span class="n">backup</span>   <span class="o">==&gt;</span> <span class="n">Backup</span> <span class="n">files</span> <span class="n">and</span> <span class="n">directories</span>
    <span class="n">mysql</span>    <span class="o">==&gt;</span> <span class="n">Create</span> <span class="n">a</span> <span class="n">backup</span> <span class="n">of</span> <span class="n">the</span> <span class="n">database</span>
    <span class="n">dumpsys</span>  <span class="o">==&gt;</span> <span class="n">Dump</span> <span class="n">system</span> <span class="n">state</span>
    <span class="n">sender</span>   <span class="o">==&gt;</span> <span class="n">Module</span> <span class="n">to</span> <span class="n">send</span> <span class="n">files</span> <span class="n">to</span> <span class="n">a</span> <span class="n">remote</span> <span class="n">server</span>
    <span class="n">iptables</span>     <span class="o">==&gt;</span> <span class="n">Module</span> <span class="n">to</span> <span class="n">control</span> <span class="n">iptables</span>
    <span class="n">ldap</span>     <span class="o">==&gt;</span> <span class="n">The</span> <span class="n">backup</span> <span class="n">database</span> <span class="n">server</span> <span class="n">openldap</span>
    <span class="n">rpmbuild</span>     <span class="o">==&gt;</span> <span class="n">RPM</span> <span class="n">collector</span> <span class="n">packages</span>
    <span class="n">misc</span>     <span class="o">==&gt;</span> <span class="n">Other</span> <span class="n">Features</span>
</code></pre></div>

<p>Это не полный список модулей, здесь перечислены модули из массива в файле конфигурации. Полный список модулей можно просмотреть в папке:</p>
<div class="highlight"><pre><span></span><code>ls -l <span class="cp">${</span><span class="n">script_root</span><span class="cp">}</span>/usr/modules
</code></pre></div>

<p>Для отображения списка параметров модуля достаточно запустить его без параметров, например:</p>
<div class="highlight"><pre><span></span><code><span class="n">$</span> <span class="n">bash</span> <span class="n">$</span><span class="p">{</span><span class="n">script_root</span><span class="p">}</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">wilshell</span><span class="p">.</span><span class="n">sh</span> <span class="n">backup</span>
<span class="o">==</span><span class="p">[</span> <span class="n">Debug</span> <span class="n">inf</span><span class="p">.</span> <span class="p">]</span><span class="o">==</span>  
    <span class="mi">2012-11-28</span><span class="n">_02</span><span class="mi">-48</span> <span class="p">[</span><span class="n">LogLevel</span> <span class="n">set</span> <span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="n">Usage</span> <span class="n">simple</span><span class="p">]</span>
<span class="o">==</span><span class="p">[</span> <span class="n">Usage</span> <span class="p">]</span><span class="o">==</span>   
<span class="o">&gt;</span> <span class="o">-</span><span class="n">b</span>  <span class="err">Путь</span> <span class="err">к</span> <span class="err">директории</span> <span class="err">содержащей</span> <span class="err">бэкапы</span> <span class="p">[</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">backup</span><span class="p">]</span>
<span class="o">&gt;</span> <span class="o">-</span><span class="n">d</span>  <span class="err">Удалять</span> <span class="err">бэкапы</span> <span class="err">старше</span> <span class="err">чем</span><span class="p">,</span> <span class="err">указанное</span> <span class="err">количество</span> <span class="err">дней</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="o">&gt;</span> <span class="o">-</span><span class="n">l</span>  <span class="err">Список</span> <span class="err">папок</span> <span class="err">для</span> <span class="err">бэкапа</span> <span class="p">[</span><span class="n">fileset</span><span class="p">.</span><span class="n">conf</span><span class="p">]</span>
<span class="o">&gt;</span> <span class="o">-</span><span class="n">c</span>  <span class="err">Директория</span> <span class="err">с</span> <span class="err">файлсетами</span> <span class="err">для</span> <span class="err">бэкапа</span> <span class="p">[..</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">fileset</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="p">]</span>
<span class="o">&gt;</span> <span class="o">-</span><span class="n">r</span>  <span class="err">Запустить</span> <span class="err">бэкап</span>
<span class="o">&gt;</span> <span class="o">-</span><span class="n">v</span>  <span class="err">Режим</span> <span class="err">отладки</span>
</code></pre></div>

<p>Некоторые модули сейчас нуждаются в рефакторинге, некоторые еще не полностью дописаны, поскольку большое внимание уделялось самому "движку", бОльшая часть функционала которого описана в  отдельной библиотеке.</p>
    <h2>Comments</h2>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
       var disqus_shortname = 'srv-nix-com';
       var disqus_identifier = 'skripty-na-vse-sluchai-zhizni.html';
       var disqus_url = 'https://srv-nix.com/skripty-na-vse-sluchai-zhizni.html';
       (function() {
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] ||
             document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the comments.</noscript>
</article>
            </div>
        </div>


        <div id="sidebar">
            <h1><a href="https://srv-nix.com " title="title">YODA</a></h1>
            <span class="description"> </span>
            <!-- <span class="feed"><a href="">RSS</a> | <a href="">Atom</a></span> -->
        </div>

        <div id="footer">
            <nav>
                <ul>
                    <li>:: <a href="https://srv-nix.com/categories.html">Categories</a></li>
                    <li>:: <a href="https://srv-nix.com/tags.html">Tags</a></li>
                </ul>
            </nav>

            <div id="credits">
                <span>Adapted from <a href="http://wordpress.org/themes/monospace">Monospace</a> || Created with <a href="">Pelican</a></span>
            </div>
                
        </div>

<script type="text/javascript">
    var disqus_shortname = 'srv-nix-com';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

    </div>

</body>
</html>